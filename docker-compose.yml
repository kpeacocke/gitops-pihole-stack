---
services:
  avahi-reflector:
    build:
      context: ./avahi
      dockerfile: Dockerfile
    platform: "linux/arm/v7"
    container_name: avahi-reflector
    network_mode: host
    restart: unless-stopped
    privileged: false
    security_opt:
      - seccomp:unconfined
    cap_drop: [ "ALL" ]
    cap_add:
      - NET_ADMIN
      - NET_RAW
      - SETUID
      - SETGID
      - SETPCAP
      - CHOWN
      - DAC_OVERRIDE
      - FOWNER
      - FSETID
      - KILL
      - SYS_CHROOT
      - SYS_NICE
      - SYS_RESOURCE
    tmpfs:
      - /run/avahi-daemon:mode=0755
      - /run/dbus:mode=0755
    volumes:
      - ./avahi/avahi-daemon.conf:/etc/avahi/avahi-daemon.conf:ro
      - ./avahi/nsswitch.conf:/etc/nsswitch.conf:ro
      - /etc/localtime:/etc/localtime:ro
    healthcheck:
      test: ["CMD-SHELL", "avahi-browse -a -t >/dev/null 2>&1 || exit 1"]
      interval: 60s
      timeout: 10s
      retries: 5