server:
  # Listen on all LAN interfaces, recursive on 5335
  interface: 0.0.0.0
  port: 5335

  # ---- Protocol & robustness ----
  do-udp: yes
  do-tcp: yes
  # Avoid fragmentation/MTU issues
  edns-buffer-size: 1232
  max-udp-size: 1232
  minimal-responses: yes
  so-reuseport: yes
  outgoing-port-permit: 1024-65535
  outgoing-port-avoid: 0-1023

  # ---- IPv6 (off for now; enable later if needed) ----
  do-ip6: no
  prefer-ip6: no

  # ---- Root trust & bootstrap ----
  root-hints: "/var/unbound/root.hints"
  auto-trust-anchor-file: "/var/unbound/key/root.key"
  harden-glue: yes
  harden-dnssec-stripped: yes
  harden-below-nxdomain: yes
  qname-minimisation: yes
  aggressive-nsec: yes
  use-caps-for-id: yes

  # ---- Privacy / identity ----
  hide-identity: yes
  hide-version: yes

  # ---- Caching (Pi 3, ~1 GB RAM) ----
  # ~200 MiB total for Unbound caches; still leaves lots of headroom
  msg-cache-size: 64m
  rrset-cache-size: 128m
  neg-cache-size: 8m
  cache-min-ttl: 15
  cache-max-ttl: 86400
  # Serve slightly stale data during upstream hiccups
  serve-expired: yes
  serve-expired-ttl: 86400
  serve-expired-client-timeout: 1800

  # Slabs (match threads; powers of two)
  msg-cache-slabs: 2
  rrset-cache-slabs: 2
  infra-cache-slabs: 2
  key-cache-slabs: 2

  # ---- Prefetching popular names ----
  prefetch: yes
  prefetch-key: yes

  # ---- Access control ----
  access-control: 127.0.0.0/8 allow
  access-control: 192.168.0.0/16 allow
  access-control: 0.0.0.0/0 refuse

  # Donâ€™t leak RFC1918/CGNAT addresses
  private-address: 10.0.0.0/8
  private-address: 100.64.0.0/10
  private-address: 172.16.0.0/12
  private-address: 192.168.0.0/16
  private-address: 169.254.0.0/16
  private-address: 127.0.0.0/8

  # Local reverse zones for private ranges
  local-zone: "10.in-addr.arpa." nodefault
  local-zone: "16.172.in-addr.arpa." nodefault
  local-zone: "17.172.in-addr.arpa." nodefault
  local-zone: "18.172.in-addr.arpa." nodefault
  local-zone: "19.172.in-addr.arpa." nodefault
  local-zone: "20.172.in-addr.arpa." nodefault
  local-zone: "21.172.in-addr.arpa." nodefault
  local-zone: "22.172.in-addr.arpa." nodefault
  local-zone: "23.172.in-addr.arpa." nodefault
  local-zone: "24.172.in-addr.arpa." nodefault
  local-zone: "25.172.in-addr.arpa." nodefault
  local-zone: "26.172.in-addr.arpa." nodefault
  local-zone: "27.172.in-addr.arpa." nodefault
  local-zone: "28.172.in-addr.arpa." nodefault
  local-zone: "29.172.in-addr.arpa." nodefault
  local-zone: "30.172.in-addr.arpa." nodefault
  local-zone: "31.172.in-addr.arpa." nodefault
  local-zone: "168.192.in-addr.arpa." nodefault

  # ---- Performance knobs for Pi 3 ----
  num-threads: 2
  num-queries-per-thread: 2048
  so-rcvbuf: 384k
  so-sndbuf: 384k
  outgoing-num-tcp: 64
  incoming-num-tcp: 64

  # ---- Abuse/loop safety ----
  ratelimit: 200

  # ---- Logging ----
  verbosity: 0
  # logfile: "/var/log/unbound/unbound.log"  # uncomment only for short-term debug